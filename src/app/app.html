<div class="business-search-app">
  <mat-toolbar color="primary">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Enter zip code or city</mat-label>
      <input 
        matInput 
        [(ngModel)]="searchQuery" 
        (keyup.enter)="performSearch()"
        placeholder="02138 or Cambridge">
    </mat-form-field>
    <button mat-raised-button color="accent" (click)="performSearch()" [disabled]="loading">
      Search
    </button>
    <span class="spacer"></span>
    <span>Business Search</span>
  </mat-toolbar>

  <div class="content-container" *ngIf="categories.length > 0">
    <mat-sidenav-container class="sidenav-container">
      <mat-sidenav opened mode="side" class="sidenav">
        <div class="sidenav-content">
          <h3>Categories ({{ categories.length }})</h3>
          <div class="category-tree">
            <ng-container *ngTemplateOutlet="categoryTemplate; context: { categories: categories, level: 0 }"></ng-container>
          </div>
        </div>
      </mat-sidenav>

      <mat-sidenav-content class="main-content">
        <div *ngIf="filteredBusinesses.length > 0" class="business-grid">
          <mat-card *ngFor="let business of filteredBusinesses" class="business-card">
            <mat-card-header>
              <mat-card-title>{{ business.name }}</mat-card-title>
              <mat-card-subtitle>{{ business.category }}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p *ngIf="business.subcategory"><strong>Type:</strong> {{ business.subcategory }}</p>
              <p *ngIf="business.address"><strong>Address:</strong> {{ business.address }}</p>
              <p *ngIf="business.phone"><strong>Phone:</strong> {{ business.phone }}</p>
              <p *ngIf="business.rating"><strong>Rating:</strong> {{ business.rating }}/5</p>
            </mat-card-content>
            <mat-card-actions *ngIf="business.website">
              <a mat-button [href]="business.website" target="_blank">Visit Website</a>
            </mat-card-actions>
          </mat-card>
        </div>
        <div *ngIf="filteredBusinesses.length === 0 && !loading" class="no-businesses">
          <mat-card>
            <mat-card-content>
              <p>No businesses found. Try selecting a different category or search for another location.</p>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-sidenav-content>
    </mat-sidenav-container>
  </div>

  <div *ngIf="categories.length === 0 && !loading" class="no-results">
    <mat-card class="welcome-card">
      <mat-card-header>
        <mat-card-title>Welcome to Business Search</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>Enter a zip code (like 02138) or city name (like Cambridge) in the search field above to find businesses in that area.</p>
      </mat-card-content>
    </mat-card>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading...</p>
  </div>
</div>

<ng-template #categoryTemplate let-categories="categories" let-level="level">
  <div *ngFor="let category of categories" class="category-item" [style.margin-left.px]="level * 20">
    <div class="category-row">
      <button 
        *ngIf="category.children && category.children.length > 0"
        mat-icon-button 
        class="expand-button"
        (click)="toggleCategory(category)">
        <mat-icon>{{ isCategoryExpanded(category) ? 'expand_less' : 'expand_more' }}</mat-icon>
      </button>
      
      <button 
        mat-button 
        class="category-button"
        [class.active]="isCategorySelected(category)"
        (click)="selectCategory(category)">
        {{ category.name }} ({{ category.count }})
      </button>
    </div>
    
    <div *ngIf="isCategoryExpanded(category) && category.children && category.children.length > 0" 
         class="subcategories">
      <ng-container *ngTemplateOutlet="categoryTemplate; context: { categories: category.children, level: level + 1 }"></ng-container>
    </div>
  </div>
</ng-template>

<router-outlet />
