<div class="business-search-app">
  <mat-toolbar color="primary">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Enter zip code or city</mat-label>
      <input 
        matInput 
        [(ngModel)]="searchQuery" 
        (keyup.enter)="performSearch()"
        placeholder="02138 or Cambridge">
    </mat-form-field>
    <button mat-raised-button color="accent" (click)="performSearch()" [disabled]="loading">
      Search
    </button>
    <span class="spacer"></span>
    <span>Business Search</span>
  </mat-toolbar>

  <div class="content-container" *ngIf="categories.length > 0">
    <mat-sidenav-container class="sidenav-container">
      <mat-sidenav opened mode="side" class="sidenav">
        <div class="sidenav-content">
          <h3>Categories ({{ categories.length }})</h3>
          <mat-nav-list>
            <mat-list-item 
              *ngFor="let category of categories" 
              (click)="selectCategory(category)"
              [class.active]="selectedCategory === category.category">
              <span>{{ category.category }} ({{ category.count }})</span>
            </mat-list-item>
            
            <div *ngIf="selectedCategory" class="subcategories">
              <ng-container *ngFor="let category of categories">
                <div *ngIf="category.category === selectedCategory && category.subcategories && category.subcategories.length > 0">
                  <mat-list-item 
                    *ngFor="let sub of category.subcategories"
                    (click)="selectSubcategory(sub)"
                    [class.active]="selectedSubcategory === sub.category"
                    class="subcategory-item">
                    <span>{{ sub.category }} ({{ sub.count }})</span>
                  </mat-list-item>
                </div>
              </ng-container>
            </div>
          </mat-nav-list>
        </div>
      </mat-sidenav>

      <mat-sidenav-content class="main-content">
        <div *ngIf="filteredBusinesses.length > 0" class="business-grid">
          <mat-card *ngFor="let business of filteredBusinesses" class="business-card">
            <mat-card-header>
              <mat-card-title>{{ business.name }}</mat-card-title>
              <mat-card-subtitle>{{ business.category }}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p *ngIf="business.subcategory"><strong>Type:</strong> {{ business.subcategory }}</p>
              <p *ngIf="business.address"><strong>Address:</strong> {{ business.address }}</p>
              <p *ngIf="business.phone"><strong>Phone:</strong> {{ business.phone }}</p>
              <p *ngIf="business.rating"><strong>Rating:</strong> {{ business.rating }}/5</p>
            </mat-card-content>
            <mat-card-actions *ngIf="business.website">
              <a mat-button [href]="business.website" target="_blank">Visit Website</a>
            </mat-card-actions>
          </mat-card>
        </div>
        <div *ngIf="filteredBusinesses.length === 0 && !loading" class="no-businesses">
          <mat-card>
            <mat-card-content>
              <p>No businesses found. Try selecting a different category or search for another location.</p>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-sidenav-content>
    </mat-sidenav-container>
  </div>

  <div *ngIf="categories.length === 0 && !loading" class="no-results">
    <mat-card class="welcome-card">
      <mat-card-header>
        <mat-card-title>Welcome to Business Search</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>Enter a zip code (like 02138) or city name (like Cambridge) in the search field above to find businesses in that area.</p>
      </mat-card-content>
    </mat-card>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading...</p>
  </div>
</div>

<router-outlet />
